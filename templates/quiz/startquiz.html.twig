{% extends 'base.html.twig' %}

{% block title %}Theme{% endblock %}

{% block body %}
    <ul>
            {% for question in questions %}

                <li>
                    <p> {{ question.libelle }} </p>
                    <ul>
                            {% for answer in question.answers %}

                            <li>
                                <label>
                                {{ answer.libelle }}
                                    <input id="{{ answer.id }}" value="{{ answer.id }}" type="radio" name="question{{ question.id }}" class="answers">
                                </label>
                            </li>

                            {% endfor %}
                    </ul>
                </li>

            {% endfor %}
            
    </ul>
    <button onClick="envoiForm()" type="submit" id="envoyer"> Confirmer </button>
    <p id="score"> </p>

    <script>
        async function envoiForm() 
        {
            answers = document.getElementsByClassName("answers");
            answerstosend = [];

             for (var answer of answers) {
                if (answer.checked) {
                    answerstosend.push(answer.defaultValue);
                }
            }

            let response = await fetch("{{path('app_quiz_submit')}}", {
                method: "POST",
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                },

                body: JSON.stringify(answerstosend)
                })
            .then(response => {
                return response.json()
            }).then(data => {
                score = document.getElementById("score");
                button = document.getElementById("envoyer");
                score.innerHTML = `Score final :${Math.round(data.score)}` + "%" ;
                inputs = document.getElementsByTagName("input");
                for (var input of inputs) {
                    input.disabled = true;
                }
                button.disabled = true;
                for (var tuple of data.res){
                    if (tuple[0] in tuple[1]){
                        x = document.getElementById(tuple[0]);
                        x.backgroundcolor = "green";
                        //$res = [[$answer],[$goodanswer]];
                    }
                    else{
                        x = document.getElementById(tuple[0]);
                        x.backgroundcolor = "red";
                    }
                    
                }
            })
        }
    </script>

{% endblock %}


